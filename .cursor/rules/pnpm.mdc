---
description: "全栈项目技术约束规范"
globs: "**/*.{ts,tsx,js,jsx,md,mdx}"  # 覆盖所有代码和文档文件
priority: 1  # 最高优先级
last_updated: "2025-08-02"
---

# 技术栈约束
## 核心框架
- **前端**：必须使用 React 18 + TypeScript 开发，禁止使用类组件（仅允许函数组件 + Hooks）[6](@ref)
- **状态管理**：禁止使用 Redux，统一使用 Context API + `useReducer`，复杂场景用 `@tanstack/react-query`[6](@ref)
- **构建工具**：前端必须基于 Vite 5.4+ 构建，禁用 Webpack/CRA[6](@ref)

## 后端规范
- **路由定义**：Koa 路由必须通过 `koa-router` 声明，且按业务模块拆分路由文件（如 `user.routes.ts`）[6](@ref)
- **安全防护**：所有 API 必须包含 JWT 校验（`koa-jwt`），敏感操作需验证用户角色[4](@ref)
- **环境变量**：必须通过 `dotenv` 加载 `.env` 文件，禁止硬编码敏感信息[6](@ref)

## 工程化要求
- **Monorepo 引用**：子包依赖必须使用 `workspace:*` 协议（如 `"@project/ui": "workspace:*"`）[6,8](@ref)
- **代码质量**：
  - ESLint 规则继承 `@eslint/js` + `eslint-plugin-react-hooks`[6](@ref)
  - 类型覆盖率：TS 接口/类型必须覆盖 95%+ 的导出函数[4](@ref)
- **测试覆盖**：
  - 组件：Vitest + `@testing-library/react`，覆盖率 ≥80%[6](@ref)
  - 工具函数：必须 100% 覆盖边界条件[4](@ref)

## 布局与组件
- **全局布局**：使用 Antd `Layout` 组件实现三栏结构，右侧功能区宽度固定 `280px`[5](@ref)
- **文档渲染**：MDX 文件必须通过 `react-markdown` + `prismjs` 实现代码高亮[5](@ref)
- **性能优化**：
  - 表格/列表必须使用 `react-virtualized` 虚拟滚动
  - 首屏加载需启用 SSR（通过 `rspress` 实现）[3](@ref)

## 安全与性能红线
- **文件上传**：超过 10MB 文件必须分片上传，后端校验文件类型白名单[4](@ref)
- **实时通信**：WebSocket 连接需设置心跳检测，断开后自动重连[5](@ref)
- **LangChain 集成**：禁止直接暴露 API Key，必须通过后端代理调用[4](@ref)